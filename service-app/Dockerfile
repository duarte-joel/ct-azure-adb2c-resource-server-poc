# Dockerfile used to build the image for production. Depends on the build being done before.
FROM cxconsumertech/alpine-adoptopenjdk11:jre-11.0.4_11
EXPOSE 8080
# 8085 is the management port, where actuactor and other probes are exposed
EXPOSE 8085

# curl is needed for docker healthchecks which are used by AWS ECS
#RUN apk add --no-cache curl=7.66.0-r0

RUN mkdir -p /opt/carlsberg/service/
WORKDIR /opt/carlsberg/service/

COPY target/*.jar ./
# copies all dependencies that where generated by dependency:copy-dependencies (runs during install phase)
COPY target/dependency/*.jar ./

USER nobody

#To disable reactor debug in prodution just remove the javaaggent
ENTRYPOINT ["java","-javaagent:./io.projectreactor.reactor-tools-3.3.5.RELEASE.jar","-Djava.security.egd=file:/dev/urandom","-cp","./*", "com.carlsberg.consumertech.service.Application"]
